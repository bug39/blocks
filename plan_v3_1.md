Planning / Spec: "Unblocker Lite v3.1" - Agentic reviewer unblocker built on IBM watsonx Orchestrate

0. Purpose and alignment (hackathon lens)

Goal: shorten PR review latency by detecting missing‑reviewer stalls and automatically requesting the right reviewers. Watsonx Orchestrate is the workflow runtime, approval gate, and audit/run‑trace system.

Theme alignment ("AI Demystified - From idea to deployment"):
- Idea: "PRs are stuck waiting for review."
- Orchestrate: evidence -> AI plan -> policy gate -> (auto) execute -> verify -> audit/run trace.
- Show a safe, approachable AI workflow that deploys quickly and works end‑to‑end.

Key promise: "We turn stalled PRs into reviewed PRs with governed, evidence‑linked actions."

1. Scope (tight MVP) and non‑goals

MVP (must ship):
- Flow A: "Why is this PR stuck?"
- Flow C: Pattern Wizard (NL -> config -> activate) is core demo
- /unblock scan (manual proactive scan; no scheduler)
- One rule: S2 "Reviewer missing"
- Tools: GitHub + Slack only
- AI: reviewer ranking + PR summary + rationale (visible in preview)
- Deterministic policy gate
- Orchestrate run trace shown in demo

Optional (stretch, only if MVP is stable):
- S3 "CI failing without author activity" (GitHub only)

Out of scope:
- Jira integration (unless added as stretch later)
- Arbitrary rule builder or free‑form expressions
- Auto‑merge/auto‑close/status transitions
- Fuzzy inference for stall triggers

2. Watsonx Orchestrate is integral (non‑negotiable)

Orchestrate owns:
- Flow state machine and step sequencing
- Approval gating and timing (auto‑exec vs explicit approval)
- Slack interactions (preview/outcome)
- Run trace and audit for demo proof

Backend (thin tools) is only for:
- GitHub API calls
- Storage of minimal run artifacts
- Deterministic policy gate evaluation

2.1 Orchestrate wiring spec (validate in spike)
- Slack command triggers Orchestrate flow via native Slack integration.
- Orchestrate calls backend over HTTPS (POST /analyze, POST /act).
- run_id generated by Orchestrate is passed through to backend and echoed in Slack previews/outcomes.
- Orchestrate run trace page is shown in demo, filtered by run_id.
Validation task: prove Slack -> Orchestrate -> backend -> Slack round trip before any other work.

3. AI roles (visible but safe)

AI is used for:
- Reviewer suggestion ranking within a deterministic candidate set
- PR summary (short, reviewer‑friendly)
- Rationale tying actions to evidence
- Pattern Wizard NL -> config extraction

AI is not used for:
- Stall classification
- Writing to external systems

AI reasoning must be visible in Slack previews (candidate list + source tags + rationale).
This keeps correctness deterministic while making AI visibly agentic.

4. Rule S2 (MVP) - Reviewer missing

Deterministic trigger:
- PR not draft
- requested_reviewers is empty
- PR ready age >= threshold (default 24h)

"Ready" definition:
- not draft
- no excluded labels (wip, blocked, parked, do‑not‑merge, waiting‑on‑external)

Meaningful activity suppression:
- If new commit, review, or comment in last X hours (default 6h), suppress S2.

Evidence keys:
- pr.created_at
- pr.draft
- pr.labels
- pr.requested_reviewers
- pr.last_activity_at

Allowed actions:
- github.request_reviewers
- github.comment (optional; reviewer summary)

Verification:
- requested_reviewers >= 1

5. Reviewer selection ladder (deterministic + AI ranking)

Candidate set (deterministic):
1) CODEOWNERS for touched paths (if available)
2) Recent contributors to touched files (last 90 days)
3) Repo default reviewers (static list)

AI step:
- Rank candidates with a short rationale referencing file paths or recent changes
- Produce reviewer summary text for Slack/PR comment

Policy gate (deterministic):
- If candidate set empty -> no action; respond "need reviewer mapping"
- If candidate set from fallback (step 3) -> mark low confidence
- Enforce max reviewers (default 2–3)

Confidence thresholds (explicit):
- High: >=2 candidates from CODEOWNERS or recent contributors
- Low: 1 candidate, or all candidates from fallback
- None: 0 candidates (no action)

6. Execution policy (fast‑by‑default)

Auto‑execute if:
- Confidence high (evidence complete + candidate set not fallback)
- Action is low‑risk (request reviewers, PR comment)

Require explicit approval if:
- Confidence low
- Any action outside allowlist

Auto‑execute safety:
- 20–30 second cancel window in Slack before execution

7. Flow A: "Why is this PR stuck?" (Slack triggered)

Trigger:
- /unblock why <PR_URL>

Orchestrate steps:
1) Fetch evidence (backend)
2) Evaluate S2 (deterministic)
3) AI plan: rank reviewers + draft summary + rationale
4) Policy gate validates plan and sets confidence
5) Slack preview card with AI reasoning:
   - Candidate list with source tags (CODEOWNERS / recent / default)
   - AI ranking + 1–2 evidence‑grounded reasons
   - Action plan + cancel/approve
6) Auto‑execute or wait for approval
7) Verify requested reviewers
8) Slack outcome card + run_id

8. Flow C: Pattern Wizard (central demo moment)

Purpose:
- "Idea -> deployment" using AI to convert plain English into S2 config

Inputs (constrained NL template):
- "If PR has no reviewers after {X} hours, request reviewers from {CODEOWNERS|recent|default}"

Parsing method (MVP explicit):
- Deterministic template/regex parser for the constrained pattern.
- Reject any input that does not match the template.
- Optional: LLM may normalize wording, but output must still match the template or be rejected.

Steps:
1) AI extracts S2 config parameters (threshold, source, excluded labels)
2) Orchestrate shows config preview
3) Dry‑run preview on a single PR (no writes)
4) Explicit approval to activate

Output:
- Activated S2 config used by Flow A

9. Slack UX (simple, fast)

Preview card includes:
- Evidence summary (age, reviewer count, last activity)
- Candidate list + source tags
- Proposed reviewers (with AI rationale)
- Action plan (request reviewers)
- Controls: Cancel / Approve / Snooze
- Auto‑execute countdown (20–30s)
Example rationale format:
- @alice — CODEOWNER for payments/
- @bob — Modified api.py 3x in last 30 days

Outcome card includes:
- Verification result
- Run ID (for Orchestrate trace)
- Metric line: "Stalled for Xh -> reviewers assigned in Ys"

9.1 /unblock scan (manual proactive)
- Command returns top 3 PRs needing reviewers
- Each item links to Flow A (review/analyze)
- No auto‑actions from scan

10. Minimal storage (MVP)

Persist only what is needed:
- run_id -> plan + execution result (for demo traceability)
- pr_state: ready_at (optional; can use created_at if simpler)

Storage options:
- SQLite recommended; JSONL acceptable for MVP

11. Demo script (3–4 minutes; tight)

1) Pattern Wizard NL -> config -> single‑PR dry‑run -> activate (60–90s)
2) /unblock scan shows top 3 stalled PRs (20–30s)
3) Run /unblock why <PR_URL> -> preview -> execute (60–90s)
4) Show Orchestrate run trace with run_id (20–30s)
Fallback: pre‑record Pattern Wizard if live parsing is unreliable.

12. Implementation path (short, build‑ready)

0) Orchestrate connectivity spike (Slack -> Orchestrate -> backend -> Slack)
1) GitHub evidence fetch (PR metadata, activity, labels, files)
2) S2 deterministic rule + suppression
3) Candidate reviewer selection ladder
4) AI ranking + PR summary + visible rationale
5) Policy gate
6) Orchestrate Flow A end‑to‑end
7) Pattern Wizard (Flow C) core MVP
8) /unblock scan command (manual proactive)
9) Demo seeds + run trace prep

13. Demo‑safe defaults (lock unless you must deviate)

- Scope: 1 GitHub repo
- Excluded labels: wip, blocked, parked, do‑not‑merge, waiting‑on‑external
- Activity window: 6 hours
- S2 threshold: 24 hours
- Max reviewers: 2–3
- Auto‑execute delay: 20–30 seconds
- Approval command: /unblock approve R‑####
- No Jira dependency in MVP

13.1 Demo repo setup checklist (must be true)
- Repo has CODEOWNERS file OR default reviewer list configured
- Seeded PR older than 24h with zero requested reviewers
- Recent activity > 6h ago (no new commits/comments)
- Candidate reviewers are valid GitHub users with permission to review
- Reset procedure documented (how to clear reviewers between runs)

14. Backend simplification (reduce build risk)

Collapse backend to two endpoints:
- POST /analyze
  - Input: PR URL (or scan mode)
  - Output: evidence + S2 match + candidate list + AI plan + policy decision
- POST /act
  - Input: approved plan + run_id
  - Output: execution result + verification

15. Risks and contingencies (condensed)

Risk: Orchestrate integration fails
- Mitigation: connectivity spike first; if blocked, pivot to Orchestrate for audit/log + Slack bridge only.

Risk: Pattern Wizard NL parsing fails live
- Mitigation: known-good input phrase; fallback to pre-generated config JSON or pre-recorded clip.

Risk: Demo timing overrun
- Mitigation: pre-record Wizard; run live only Flow A + trace in 2-minute fallback.

14. Risks and mitigations (critical)

Risk: "AI is window dressing"
- Mitigation: AI ranks reviewers and summarizes PR; Pattern Wizard is central in demo.

Risk: Reviewer selection is noisy
- Mitigation: deterministic candidate set + allowlist + fallback confidence; explicit approval on fallback.

Risk: Orchestrate not visible
- Mitigation: show run trace in demo with run_id correlation to Slack output.

Risk: Slow approvals
- Mitigation: auto‑execute low‑risk actions with cancel window; approvals only on low confidence.
